version: 0

# Example AWS Secrets Manager configuration
providers:
  aws_sm:
    type: aws.secretsmanager
    region: us-east-1  # Required: AWS region
    
  # Multiple regions example
  aws_sm_west:
    type: aws.secretsmanager
    region: us-west-2

# Environment definitions with AWS Secrets Manager
envs:
  development:
    # Simple secret (entire value)
    DATABASE_PASSWORD:
      from: { provider: aws_sm, key: "dev/database/password" }
    
    # JSON secret with field extraction
    DATABASE_URL:
      from: { provider: aws_sm, key: "dev/database/config" }
      transform: json_extract:.url
    
    # Secret with specific version
    API_KEY:
      from: { provider: aws_sm, key: "dev/api/keys", version: "AWSCURRENT" }
    
    # JSON extraction from nested structure
    REDIS_HOST:
      from: { provider: aws_sm, key: "dev/cache/config" }
      transform: json_extract:.redis.host
    
    REDIS_PORT:
      from: { provider: aws_sm, key: "dev/cache/config" }
      transform: json_extract:.redis.port
    
    # Multi-region secrets
    BACKUP_KEY:
      from: { provider: aws_sm_west, key: "backup/encryption/key" }
    
    # Non-secret configuration
    NODE_ENV:
      literal: "development"

  staging:
    DATABASE_URL:
      from: { provider: aws_sm, key: "staging/database/config" }
      transform: json_extract:.url
    
    API_KEY:
      from: { provider: aws_sm, key: "staging/api/keys" }
      transform: json_extract:.primary
    
    NODE_ENV:
      literal: "staging"

  production:
    # Production secrets with specific versions for stability
    DATABASE_URL:
      from: { provider: aws_sm, key: "prod/database/primary", version: "AWSCURRENT" }
    
    DATABASE_REPLICA_URL:
      from: { provider: aws_sm, key: "prod/database/replica" }
      transform: json_extract:.connection_string
    
    # API secrets
    STRIPE_SECRET_KEY:
      from: { provider: aws_sm, key: "prod/stripe/secret" }
    
    JWT_SECRET:
      from: { provider: aws_sm, key: "prod/auth/jwt" }
      transform: json_extract:.secret
    
    # Certificate/key pairs stored as JSON
    TLS_CERT:
      from: { provider: aws_sm, key: "prod/tls/certificate" }
      transform: json_extract:.cert
      
    TLS_KEY:
      from: { provider: aws_sm, key: "prod/tls/certificate" }
      transform: json_extract:.key
    
    NODE_ENV:
      literal: "production"
    
    # Optional secrets
    FEATURE_FLAGS:
      from: { provider: aws_sm, key: "prod/features/flags" }
      optional: true

# Example secret structures in AWS Secrets Manager:

# Secret: "dev/database/config"
# {
#   "url": "postgresql://user:pass@db.example.com:5432/myapp",
#   "host": "db.example.com",
#   "port": 5432,
#   "username": "myapp_user",
#   "password": "secure_password"
# }

# Secret: "dev/cache/config"  
# {
#   "redis": {
#     "host": "redis.example.com",
#     "port": 6379,
#     "password": "redis_secret"
#   }
# }

# Secret: "prod/tls/certificate"
# {
#   "cert": "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----",
#   "key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
# }