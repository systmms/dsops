# Lefthook configuration for dsops
# Install hooks: make install-hooks (or: npx lefthook install)
# Uninstall hooks: make uninstall-hooks (or: npx lefthook uninstall)
#
# Documentation: https://github.com/evilmartians/lefthook

pre-commit:
  parallel: false
  commands:
    mod-tidy-check:
      glob: "{*.go,go.mod,go.sum}"
      run: |
        echo "Checking if go.mod and go.sum are tidy..."
        cp go.mod go.mod.bak && cp go.sum go.sum.bak
        go mod tidy
        if ! diff -q go.mod go.mod.bak >/dev/null 2>&1 || ! diff -q go.sum go.sum.bak >/dev/null 2>&1; then
          echo ""
          echo "go.mod or go.sum is not tidy. Run: go mod tidy"
          mv go.mod.bak go.mod && mv go.sum.bak go.sum
          exit 1
        fi
        rm -f go.mod.bak go.sum.bak
        echo "go.mod and go.sum are tidy"
